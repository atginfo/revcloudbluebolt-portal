<!--
  @description       : 
  @author            : David Sam
  @group             : Cognizant
  @last modified on  : 07-01-2025
  @last modified by  : Frank Berni
-->

<template>
  <div>
    <lightning-card title={dynamicTitle} icon-name="custom:custom17" class="slds-m-around_medium">
    
      <lightning-button icon-name="utility:expand_alt" variant="container" label={expandCollapseLabel} onclick={toggleExpandCollapseAll}></lightning-button>
      
      <div class="slds-size_1-of-3" style="width: 50%">
        <div class="right-aligned-container">
          <!-- NEW updated label and removed tooltip -->
          <lightning-input 
              type="date" name="assetDate" 
              label="View Products and Quantities as of" 
              value={validityDate}
              date-style="short" 
              variant="label-inline" 
              onchange={handleInputChange}>
          </lightning-input>
        </div>
      </div>

      <!-- NEW updated key-field to use Id -->
      <lightning-tree-grid  
        data={gridDataWithHighlight}
        columns={columns}
        expanded-rows={expandedRows}
        onsort={doSorting}
        onrowselection={handleRowSelection}
        onrowaction={handleRowAction}
        max-row-selection="1"
        key-field="Id"
        row-class={rowClass}>
      </lightning-tree-grid>

      <template if:true={renderFlow}>
          <section role="dialog" tabindex="-1" aria-modal="true" class="slds-modal slds-fade-in-open">
              <div class="slds-modal__container">
                  <header class="slds-modal__header">
                      <button class="slds-button slds-modal__close" title="Close" onclick={closeModal}>
                          <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
                      </button>
                      <h2 class="slds-text-heading_medium">Asset Action</h2>
                  </header>
                  <div class="slds-modal__content slds-p-around_medium">
                      <lightning-flow
                          flow-api-name={flowApiName}
                          flow-input-variables={flowInputVariables}
                          onstatuschange={handleStatusChange}
                          onfinish={handleFinish}>
                      </lightning-flow>
                  </div>
                  <footer class="slds-modal__footer">
                      <button class="slds-button slds-button_neutral" onclick={closeModal}>Close</button>
                  </footer>
              </div>
          </section>
          <div class="slds-backdrop slds-backdrop_open"></div>
      </template>

    </lightning-card>
  </div>
</template>